{
  "hash": "b7edab742e435eec167385ac2ad974ac",
  "result": {
    "markdown": "---\nengine: knitr\n---\n\n\n# Parameter Estimation with Prior Probabilities\n\n## Predicting Email Conversion Rates\n\n> Our data so far tells us that of the first five people that open an\n> email, two of them click the link.\n\n![The beta distribution for our observations so\nfar](img/14fig01.jpg){#fig-14-01\nfig-alt=\"Beta curve with wide range of possible values. Modus of the conversion rate is about 30-35%\"\nfig-align=\"center\" width=\"70%\"}\n\n> Unlike in the previous chapter, where we had a pretty narrow spike in\n> possible values, here we have a huge range of possible values for the\n> true conversion rate because we have very little information to work\n> with.\n\n> The 95 percent confidence interval (i.e., a 95 percent chance that our\n> true conversion rate is somewhere in that range) is marked to make it\n> easier to see. At this point our data tells us that the true\n> conversion rate could be anything between 0.05 and 0.8! This is a\n> reflection of how little information we've actually acquired so far.\n\n![CDF for our observation](img/14fig02.jpg){#fig-14-02\nfig-alt=\"Beta curve with modus about a conversion rate of about 30-35%\"\nfig-align=\"center\" width=\"70%\"}\n\n## Taking in Wider Context with Priors\n\nThis data (80% conversion rate) seems unrealistic.\n\n> Let's look at some wider context. For blogs listed in the same\n> category as yours, the provider's data claims that on average only 2.4\n> percent of people who open emails click through to the content.\n\nWe learned about producing the <a class='glossary' title='It is the revised or updated probability of an event occurring after taking into consideration new information. (Investopedia). Posterior probability = prior probability + new evidence (called likelihood). (Statistics How To) The posterior distribution will be a distribution of Gaussian distributions. (SR, Chap.4). It quantifies exactly how much our observed data changes our beliefs: P(belief | data) (BF, Chap.8)'>posterior probability</a>\nwith the combination of <a class='glossary' title='The Prior Probability, also called the Prior, is the assumed probability distribution before we have seen the data. (Wikipedia) It quantifies how likely our initial belief is: P(belief). (BF, Chap.8)'>prior probability</a> and\n<a class='glossary' title='The likelihood function (often simply called the likelihood) is the joint probability (or probability density) of observed data viewed as a function of the parameters of a statistical model. (Wikipedia) It indicates how likely a particular population is to produce an observed sample. (&lt;a href=“https://www.statistics.com/glossary/likelihood-function/&gt;statistics.com) It is the probability of the data given our beliefs about the data: P(data | belief). (BF, Chap.8)'>likelihood</a> distribution in @sec-chap-09. The prior will\nchange if new data (likelihood) come in. This process is called\n<a class='glossary' title='A Bayesian model begins with one set of plausibilities assigned to each of these possibilities. These are the prior plausibilities. Then it updates them in light of the data, to produce the posterior plausibilities. This updating process is a kind of learning. (Chap.2)'>Bayesian updating</a>.\n\n> As you know by now, in Bayesian terms the data we have observed is our\n> likelihood, and the external context information---in this case from\n> our personal experience and our email service---is our prior\n> probability. Our challenge now is to figure out how to model our\n> prior.\n\n> The conversion rate of 2.4 percent from your email provider gives us a\n> starting point: now we know we want a beta distribution whose mean is\n> roughly 0.024. (The mean of a beta distribution is\n> \\$\\frac{\\alpha}{\\alpha + \\beta}.) However, this still leaves us with a\n> range of possible options: Beta(1,41), Beta(2,80), Beta(5,200),\n> Beta(24,976), and so on. So which should we use? Let's plot some of\n> these out and see what they look like (see @fig-14-03).\n\n::: callout-note\nIn the meanwhile I learned from [@kruschke2014] that the calculation of\ndifferent forms of the beta distribution is very important to model your\nprior beliefs. I think there are several R packages and Kruschke is also\noffering some scripts for this task. It also important to get a general\nimpression how $\\alpha$ and $\\beta$ work together to form very different\nbeta distribution.\n:::\n\n![Comparing different possible prior\nprobabilities](img/14fig03.jpg){#fig-14-03\nfig-alt=\"Three different beta distributions\" fig-align=\"center\"\nwidth=\"70%\"}\n\n::: {.callout-important}\nThe lower the combined $\\alpha + \\beta$, the wider our distribution.\n:::\n\n> The problem now is that even the most liberal option we have, Beta(1,41), seems a little too pessimistic, as it puts a lot of our probability density in very low values. We’ll stick with this distribution nonetheless, since it is based on the 2.4 percent conversion rate in the data from the email provider, and is the weakest of our priors.\n\nWhy not use Beta(2, 80)? It is not so weak but still not very commiting. In my opinion it seems better providing the 2.4 percent conversion rate.\n\n> we can calculate our posterior distribution (the combination of our likelihood and our prior) by simply adding together the parameters for the two beta distributions:\n\n\n$$\n\\begin{align*}\nBeta(\\alpha_{posterior}, \\beta_{posterior}) = Beta(\\alpha_{likelihood} + \\alpha_{prior}, \\beta_{likelihood} + \\beta_{prior})\n\\end{align*}\n$$ {#eq-add-two-beta}\n\n![Comparing our likelihood (no prior) to our posterior (with prior)](img/14fig04.jpg){#fig-14-04\nfig-alt=\"Two curves: A flat but wide likelihood curve, stretching until 80% (!) and curve for the posterior probability including the prior probability with an extreme spike at about 0.8%\" fig-align=\"center\"\nwidth=\"70%\"}\n\nThis is a big surprise! \n\n> Even though we’re working with a relatively weak prior, we can see that it has made a huge impact on what we believe are realistic conversion rates. Notice that for the likelihood with no prior, we have some belief that our conversion rate could be as high as 80 percent. … Adding a prior to our likelihood adjusts our beliefs so that they become much more reasonable. But I still think our updated beliefs are a bit pessimistic.\n\n> We wait a few hours to gather more results and now find that out of 100 people who opened your email, 25 have clicked the link!\n\n\n![Updating our beliefs with more data](img/14fig05.jpg){#fig-14-05\nfig-alt=\"Two spiked curves: The likelihood curve (without prior) has a smaller spike at about 30% in contrast to the higher spike of the posterior probability (with prior) at about 15-18%\" fig-align=\"center\"\nwidth=\"70%\"}\n\n> In the morning we find that 300 subscribers have opened their email, and 86 of those have clicked through. @fig-14-06 shows our updated beliefs.\n\n![Our posterior beliefs with even more data added](img/14fig06.jpg){#fig-14-06\nfig-alt=\"Two curves now side by side. The likelihood curve is still more optimistic but the difference to the posterior probability is relatively small (about 30% versus 25%)\" fig-align=\"center\"\nwidth=\"70%\"}\n\nNow the two curves are side by side. The likelihood curve is still more optimistic but the difference to the posterior probability is relatively small by visual inspection (about 30% versus 25%).\n\n## Prior as a Means of Quantifying Experience\n\n### Is There a Fair Prior to Use When We Know Nothing?\n\nWill Kurt’s answer is: No!\n\n> In the absence of sufficient data and any prior information, your only honest option is to throw your hands in the air and tell your friend, “I have no clue how to even reason about that question!”\n\nIn the [literature](https://www.sciencedirect.com/topics/mathematics/noninformative-prior) there is much talk about a <a class='glossary' title='A prior distribution which is specified in an attempt to be non commital about a parameter, for example, a uniform distribution. (The Cambridge Dictionary of Statistics, CDS, p.303)'>non-informative prior</a> with $Beta(1,1)$\n\n\n![The noninformative prior Beta(1,1)](img/14fig07.jpg){#fig-14-07 \nfig-alt=\"A perfectly straight line, with the mean likelihood of 0.5\" fig-align=\"center\" \nwidth=\"70%\"}\n\n> As you can see, this is a perfectly straight line, so that all outcomes are then equally likely and the mean likelihood is 0.5.\n\n$$\\text{mean of likelihood} = \\frac{\\alpha}{\\alpha + \\beta} = \\frac{1}{1 + 1} = \\frac{1}{2} = 0.5$$ {#eq-mean-noninformative-prior}\n\n::: {.callout-note}\nThere is much discussion on this topic. People arguing that there is not such thing as a non-informative prior. I want not to go into further details here.\n:::\n\n> A Beta(1,1) prior is sometimes used in practice, but you should use it only when you earnestly believe that the two possible outcomes are, as far as you know, equally likely.\n\n## Wrapping Up\n\n> Whenever possible, it’s best to use a prior probability distribution based on actual data. However, often we won’t have data to support our problem, but we either have personal experience or can turn to experts who do. In these cases, it’s perfectly fine to estimate a probability distribution that corresponds to your intuition. Even if you’re wrong, you’ll be wrong in a way that is recorded quantitatively. Most important, even if your prior is wrong, it will eventually be overruled by data as you collect more observations.\n\n## Exercises\n\nTry answering the following questions to see how well you understand priors. The solutions can be found at https://nostarch.com/learnbayes/.\n\n### Exercise 14-1\n\nSuppose you’re playing air hockey with some friends and flip a coin to see who starts with the puck. After playing 12 times, you realize that the friend who brings the coin almost always seems to go first: 9 out of 12 times. Some of your other friends start to get suspicious. Define prior probability distributions for the following beliefs:\n- One person who weakly believes that the friend is cheating and the true rate of coming up heads is closer to 70 percent.\n- One person who very strongly trusts that the coin is fair and provided a 50 percent chance of coming up heads.\n- One person who strongly believes the coin is biased to come up heads 70 percent of the time.\n\n### Exercise 14-2\n\nTo test the coin, you flip it 20 more times and get 9 heads and 11 tails. Using the priors you calculated in the previous question, what are the updated posterior beliefs in the true rate of flipping a heads in terms of the 95 percent confidence interval?\n\n## Experiments\n\n### Replicate Figure 14-1\n\nHover the cursor over @fig-14-01 to compare both plots!\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-1 lst-cap=\"Draw beta distribution for our observations so far\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y = dbeta(x, 2, 3)) |> \n    ggplot2::ggplot(ggplot2::aes(x = x, y = y)) +\n    ggplot2::geom_line() +\n    ggplot2::theme_bw() +\n    ggplot2::labs(\n        title = \"Beta(2, 3) likelihood for possible conversion rates\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![The beta distribution for our observations so far](14-prior-probabilities_files/figure-html/fig-pb-14-1-1.png){#fig-pb-14-1 fig-align='center' width=70%}\n:::\n:::\n\n\n\n\n### Replicate Figure 14-2\n\nHover the cursor over @fig-14-02 to compare both plots!\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-2 lst-cap=\"Draw CDF with 95 percent credible interval\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y = pbeta(x, 2, 3)) |> \n    ggplot2::ggplot(ggplot2::aes(x = x, y = y)) +\n    ggplot2::geom_line() +\n    ggplot2::geom_segment(\n          ggplot2::aes(x = 0, y = 0.025, xend = 1, yend = 0.025),\n              linewidth = 0.4, linetype = \"dashed\", color = \"steelblue\") +\n    ggplot2::geom_segment(\n      ggplot2::aes(x = 0, y = 0.975, xend = 1, yend = 0.975),\n          linewidth = 0.4, linetype = \"dashed\", color = \"steelblue\") +\n    ggplot2::theme_bw() +\n    ggplot2::labs(\n        title = \"CDF for Beta(2, 3)\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![CDF for our observation](14-prior-probabilities_files/figure-html/fig-pb-14-2-1.png){#fig-pb-14-2 fig-align='center' width=70%}\n:::\n:::\n\n\n### Replicate Figure 14-3\n\nHover the cursor over @fig-14-03 to compare both plots!\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-3 lst-cap=\"Draw different possible prior probabilities\"}\ntibble::tibble(x = seq(0, 0.15, .0001),\n               y1 = dbeta(x, 1, 41),\n               y2 = dbeta(x, 2, 80),\n               y3 = dbeta(x, 5, 200)) |> \n    ggplot2::ggplot() +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y1, color = \"Beta(1, 41)\"),  linewidth = 1.0) +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y2, color = \"Beta(2, 80)\"),  linewidth = 1.0) +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y3, color = \"Beta(5, 200)\"), linewidth = 1.0) +\n    ggplot2::theme_bw() +\n    ggplot2::theme(legend.position = \"top\") +\n    ggplot2::scale_color_manual(name = \"Distributions:\", \n             values = c(\"Beta(1, 41)\" = \"red\",\n                        \"Beta(2, 80)\" = \"blue\",\n                        \"Beta(5, 200)\" = \"black\")) +\n    ggplot2::labs(\n        title = \"Possible priors for email conversion rate\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![Comparing different possible prior probabilities](14-prior-probabilities_files/figure-html/fig-pb-14-3-1.png){#fig-pb-14-3 fig-align='center' width=70%}\n:::\n:::\n\n\n### Replicate Figure 14-4\n\n\n\nWe need to calculate the posterior distribution (the combination of our likelihood and our prior) by simply adding together the parameters for the two beta distributions. Remember: We started with five people that opened the email, where two of them click the link we provided. \n\nWe are going to use @eq-add-two-beta to compute the posterior distribution.\n\n\n\n$$\n\\begin{align*}\nBeta(\\alpha_{posterior}, \\beta_{posterior}) = Beta(\\alpha_{likelihood} + \\alpha_{prior}, \\beta_{likelihood} + \\beta_{prior}) \\\\\nBeta(\\alpha_{posterior}, \\beta_{posterior}) = Beta(2 + 1, 3 + 41) = Beta(3, 44) \\\\\nBeta(\\alpha_{likelihood} + \\beta_{likelihood}) = Beta(2, 3)\n\\end{align*}\n$$ {#eq-calc-posterior}\n\n\nSummarized we got:\n\n- Prior: Beta(1,41)\n- Likelihood: Beta(2, 3)\n- Posterior: Beta(2 + 1, 3 + 41) = Beta(3, 44)\n\nHover the cursor over @fig-14-04 to compare both plots!\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-4 lst-cap=\"Draw likelihood (no prior) and posterior (with prior)\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y1 = dbeta(x, 2, 3),\n               y2 = dbeta(x, 3, 44)) |> \n    ggplot2::ggplot() +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y1, color = \"No prior\"),  linewidth = 1.0) +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y2, color = \"With prior\"),  linewidth = 1.0) +\n    ggplot2::theme_bw() +\n    ggplot2::theme(legend.position = \"top\") +\n    ggplot2::scale_color_manual(name = \"Distributions:\", \n             values = c(\"With prior\" = \"black\",\n                        \"No prior\" = \"red\")) +\n    ggplot2::guides(colour = ggplot2::guide_legend(reverse = TRUE)) +\n    ggplot2::labs(\n        title = \"Estimates of conversion rate with and without prior\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![Comparing our likelihood (no prior) to our posterior (with prior)](14-prior-probabilities_files/figure-html/fig-pb-14-4-1.png){#fig-pb-14-4 fig-align='center' width=70%}\n:::\n:::\n\n\n### Replicate Figure 14-5\n\n> We wait a few hours to gather more results and now find that out of 100 people who opened your email, 25 have clicked the link! \n\nI interpret these figures as the total of people, e.g, including the 5 people from the first count.\n\nThis time our new prior is the previous posterior and we are have to add the new prior to the new likelihood: \n\n- New prior is the previous posterior: Beta(3, 44)\n- New Likelihood: Beta(25, 75)\n- New Posterior: Beta(25 + 3, 75 + 44) = Beta(28, 119)\n\nHover the cursor over @fig-14-05 to compare both plots!\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-5 lst-cap=\"Update likelihood (no prior) and posterior (with prior)\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y1 = dbeta(x, 25, 75),\n               y2 = dbeta(x, 28, 119)) |> \n    ggplot2::ggplot() +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y1, color = \"No prior\"),  linewidth = 1.0) +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y2, color = \"With prior\"),  linewidth = 1.0) +\n    ggplot2::theme_bw() +\n    ggplot2::theme(legend.position = \"top\") +\n    ggplot2::scale_color_manual(name = \"Distributions:\", \n             values = c(\"With prior\" = \"black\",\n                        \"No prior\" = \"red\")) +\n    ggplot2::guides(colour = ggplot2::guide_legend(reverse = TRUE)) +\n    ggplot2::labs(\n        title = \"Estimates of conversion rate with and without prior\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![Updating our beliefs with more data](14-prior-probabilities_files/figure-html/fig-pb-14-5-1.png){#fig-pb-14-5 fig-align='center' width=70%}\n:::\n:::\n\n\n::: {.callout-warning}\nThe red beta distribution without prior does not conform to @fig-14-05. The spike should be around 0.30 and should be just under density 8. But as far as I understand my calculation is correct. I would get a similar distribution with Beta around (25, 57), but I do not know how to get this result. My relation is  $25 / 75 = 0.33$ but should have a relation of about $25 / 57 = 0.44$. I do not know how to produce this relation with an arguable calculation. Even a total of 105 people with a Beta(27, 78) would not change much (0.35)\n:::\n\n\n### Replicate Figure 14-6\n\nIn the morning we find that 300 subscribers have opened their email, and 86 of those have clicked through.\n\nI will stick with my calculation procedure, even if I do not get exact the same result as in the book.\n\n- New prior is the previous posterior: Beta(28, 119)\n- New Likelihood: Beta(86, 214)\n- New Posterior: Beta(86 + 28, 214 + 119) = Beta(114, 333)\n\nHover the cursor over @fig-14-06 to compare both plots!\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-6 lst-cap=\"Draw beta distribution for our observations so far\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y1 = dbeta(x, 86, 214),\n               y2 = dbeta(x, 114, 333)) |> \n    ggplot2::ggplot() +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y1, color = \"No prior\"),  linewidth = 1.0) +\n    ggplot2::geom_line(ggplot2::aes(x = x, y = y2, color = \"Width prior\"),  linewidth = 1.0) +\n    ggplot2::theme_bw() +\n    ggplot2::theme(legend.position = \"top\") +\n    ggplot2::scale_color_manual(name = \"Distributions:\", \n             values = c(\"Width prior\" = \"black\",\n                        \"No prior\" = \"red\")) +\n    ggplot2::guides(colour = ggplot2::guide_legend(reverse = TRUE)) +\n    ggplot2::labs(\n        title = \"Estimates of conversion rate with and without prior\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![The beta distribution for our observations so far](14-prior-probabilities_files/figure-html/fig-pb-14-6-1.png){#fig-pb-14-6 fig-align='center' width=70%}\n:::\n:::\n\n\nThis time my graph looks pretty similar as @fig-14-06!\n\n\n### Replicate Figure 14-7\n\n\nHover the cursor over @fig-14-07 to compare both plots!\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-7 lst-cap=\"Draw non-informative prior Beta(1,1)\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y = dbeta(x, 1, 1)) |> \n    ggplot2::ggplot(ggplot2::aes(x = x, y = y)) +\n    ggplot2::geom_line() +\n    ggplot2::theme_bw() +\n    ggplot2::labs(\n        title = \"Non-inforamtive prior Beta(1, 1)\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![The noninformative prior Beta(1,1)](14-prior-probabilities_files/figure-html/fig-pb-14-7a-1.png){#fig-pb-14-7a fig-align='center' width=70%}\n:::\n:::\n\n\nDrawing a straight line is also done with `dunif(x, min = 0, max = 1)` (= the uniform distribution). As `min = 0, max = 1`are the default values you just can say `dunif(x)` as @fig-pb-14-7b demonstrates:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code #lst-fig-pb-14-7b lst-cap=\"Draw non-informative with the uniform distribution\"}\ntibble::tibble(x = seq(0, 1, .0001),\n               y = dunif(x)) |> \n    ggplot2::ggplot(ggplot2::aes(x = x, y = y)) +\n    ggplot2::geom_line() +\n    ggplot2::theme_bw() +\n    ggplot2::labs(\n        title = \"Non-inforamtive prior with dunif(x, min = 0, max = 1)\",\n        x = \"Conversion rate\",\n        y = \"Density\"\n    )\n```\n\n::: {.cell-output-display}\n![The noninformative with the uniform distribution](14-prior-probabilities_files/figure-html/fig-pb-14-7b-1.png){#fig-pb-14-7b fig-align='center' width=70%}\n:::\n:::\n",
    "supporting": [
      "14-prior-probabilities_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}